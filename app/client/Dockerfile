# Build the app
FROM node:18-alpine AS builder
WORKDIR /app

ARG NEXT_PUBLIC_SUPERSET_URL
ENV NEXT_PUBLIC_SUPERSET_URL=${NEXT_PUBLIC_SUPERSET_URL}

ARG NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_CAT
ENV NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_CAT=${NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_CAT}

ARG NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_REGSHO
ENV NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_REGSHO=${NEXT_PUBLIC_SUPERSET_DASHBOARD_ID_REGSHO}

ARG NEXT_PUBLIC_SUPERSET_ADMIN_USERNAME
ENV NEXT_PUBLIC_SUPERSET_ADMIN_USERNAME=${NEXT_PUBLIC_SUPERSET_ADMIN_USERNAME}

ARG NEXT_PUBLIC_SUPERSET_ADMIN_PASSWORD
ENV NEXT_PUBLIC_SUPERSET_ADMIN_PASSWORD=${NEXT_PUBLIC_SUPERSET_ADMIN_PASSWORD}

ARG NEXT_PUBLIC_SUPERSET_GUEST_USERNAME
ENV NEXT_PUBLIC_SUPERSET_GUEST_USERNAME=${NEXT_PUBLIC_SUPERSET_GUEST_USERNAME}

ARG NEXT_PUBLIC_SUPERSET_GUEST_FIRST_NAME
ENV NEXT_PUBLIC_SUPERSET_GUEST_FIRST_NAME=${NEXT_PUBLIC_SUPERSET_GUEST_FIRST_NAME}

ARG NEXT_PUBLIC_SUPERSET_GUEST_LAST_NAME
ENV NEXT_PUBLIC_SUPERSET_GUEST_LAST_NAME=${NEXT_PUBLIC_SUPERSET_GUEST_LAST_NAME}

COPY . .

RUN npm install && npm run build

# Production image
FROM node:18-alpine AS runner
WORKDIR /app
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json

EXPOSE 3000
CMD ["npm", "start"]